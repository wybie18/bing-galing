import{r as i,j as e,H as F,a as d,L as H}from"./app-E33wXCP4.js";import{z as c,A as z}from"./AuthenticatedLayout-DgZ6locj.js";import{n as K,s as J,t as O,u as X,v as g,w as q,i as Q,x as V,d as Y,k as Z,b as ee,y as se,a as C,L,c as ae,z as te,A as k,B as f}from"./index-CBXdtjI5.js";import{M}from"./index-4Cr1BXSf.js";import re from"./PauseGameModal-DMs65O0d.js";import le from"./EndGameModal-BH2j12bP.js";import"./transition-BCReLfx2.js";function ge({game:m}){const[a,u]=i.useState(m.data),[S,h]=i.useState(!1),[P,y]=i.useState(!1),[p,b]=i.useState(a.max_players),[N,w]=i.useState([]),[E,x]=i.useState(!1),[G,v]=i.useState(!1),[l,n]=i.useState(!1);i.useEffect(()=>{u(m.data);const s=m.data.players.filter(t=>t.status==="won").sort((t,r)=>new Date(t.won_at)-new Date(r.won_at));w(s)},[m.data]),i.useEffect(()=>(Echo.channel(`game.${a.game_code}`).listen(".player.joined",s=>{console.log("Player joined:",s),u(t=>({...t,players:[...t.players,s.player]})),c.success(s.message)}).listen(".player.left",s=>{console.log("Player left:",s),u(t=>({...t,players:t.players.filter(r=>r.id!==s.player.id)})),c.error(s.message)}).listen(".player.status.changed",s=>{console.log("Player status changed:",s),u(t=>({...t,players:t.players.map(r=>r.id===s.player.id?s.player:r)})),s.is_winner?(w(t=>t.some(o=>o.id===s.player.id)?t:(c.success(s.message),[...t,s.player])),setGameStats(t=>({...t,playersWithBingo:t.playersWithBingo+1}))):c(s.message)}).error(s=>{console.error("Echo error:",s)}),()=>{Echo.leaveChannel(`game.${a.game_code}`)}),[a.game_code]);const $=async()=>{try{await navigator.clipboard.writeText(a.game_code),v(!0),setTimeout(()=>v(!1),2e3)}catch(s){console.error("Failed to copy: ",s)}},A=()=>{if(p===a.max_players){x(!1);return}n(!0),d.patch(route("games.update",a.game_code),{max_players:p},{onSuccess:()=>{x(!1),n(!1),c.success("Matagumpay na na-update ang laro!")},onError:()=>{b(a.max_players),x(!1),n(!1)}})},B=()=>{if(a.players.length===0){c.error("Hindi maaaring simulan ang laro nang walang mga manlalaro");return}n(!0),d.post(route("games.start",a.game_code),{},{onSuccess:()=>c.success("Matagumpay na nagsimula ang laro!"),onFinish:()=>n(!1)})},D=async()=>{n(!0);const s=a.can_pause,t=a.can_resume,r=t?"resume":"pause";try{const o=s?"games.pause":"games.resume";await axios.post(route(o,a.game_code));const _=t?"Matagumpay na na-resume ang laro!":"Matagumpay na na-pause ang laro!";c.success(_),d.visit(route("games.start",a.game_code))}catch(o){console.error(`Error ${r}ing game:`,o),o.response?.data?.message?alert(o.response.data.message):alert(t?"Nabigong i-resume ang laro. Paki-try muli.":"Nabigong i-pause ang laro. Paki-try muli.")}finally{n(!1)}},I=()=>{n(!0),d.post(route("games.end",a.game_code),{},{onSuccess:()=>{y(!1),n(!1),c.success("Natapos na ang laro!")},onError:()=>{n(!1)}})},W=s=>{const t={waiting:{bg:"bg-yellow-100",text:"text-yellow-800",label:"Naghihintay ng mga Manlalaro",icon:C},active:{bg:"bg-green-100",text:"text-green-800",label:"Aktibo",icon:f},paused:{bg:"bg-orange-100",text:"text-orange-800",label:"Naka-pause",icon:k},finished:{bg:"bg-gray-100",text:"text-gray-800",label:"Tapos na ang Laro",icon:M}},r=t[s]||t.waiting,o=r.icon;return e.jsxs("div",{className:`inline-flex items-center px-4 py-2 rounded-lg text-sm font-medium ${r.bg} ${r.text}`,children:[e.jsx(o,{className:"w-4 h-4 mr-2"}),r.label]})},j=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),R=()=>{const s=[];return a.status==="waiting"&&s.push(e.jsxs("button",{onClick:B,disabled:l||m.players_count===0,className:"inline-flex items-center px-6 py-3 bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm",children:[l?e.jsx(g,{className:"w-5 h-5 mr-2 animate-spin"}):e.jsx(f,{className:"w-5 h-5 mr-2"}),"Sisimulan ang Laro"]},"start")),a.status==="active"&&s.push(e.jsxs("button",{onClick:()=>h(!0),disabled:l,className:"inline-flex items-center px-4 py-2 bg-orange-600 hover:bg-orange-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm mr-3",children:[l?e.jsx(g,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(k,{className:"w-4 h-4 mr-2"}),"I-pause"]},"pause")),a.status==="paused"&&s.push(e.jsxs("button",{onClick:()=>h(!0),disabled:l,className:"inline-flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm mr-3",children:[l?e.jsx(g,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(f,{className:"w-4 h-4 mr-2"}),"I-resume"]},"resume")),(a.status==="active"||a.status==="paused")&&s.push(e.jsxs("button",{onClick:()=>y(!0),disabled:l,className:"inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm",children:[l?e.jsx(g,{className:"w-4 h-4 mr-2 animate-spin"}):e.jsx(M,{className:"w-4 h-4 mr-2"}),"Tapusin ang Laro"]},"end")),s},T=s=>({joined:"bg-blue-100 text-blue-800",playing:"bg-green-100 text-green-800",won:"bg-yellow-100 text-yellow-800",disconnected:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",U=s=>["🥇","🥈","🥉"][s]||"🏆";return e.jsxs(z,{header:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-400 to-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(L,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:["Game: ",a.game_code]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a.word_bank?.name," •"," ",a.word_bank?.word_count," words"]})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:R()})]}),children:[e.jsx(F,{title:`Laro ${a.game_code}`}),e.jsx("div",{className:"py-6 sm:py-8",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>d.visit(route("games.index")),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(K,{className:"w-4 h-4 mr-1"}),"Bumalik sa Mga Laro"]})}),a.status!="waiting"&&e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>d.visit(route("games.start.show",a.game_code)),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 transition-colors",children:["Ipakita ang laro",e.jsx(J,{className:"w-4 h-4 ml-1"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Detalye ng Laro"}),W(a.status)]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Game Code"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 p-3 bg-gray-50 rounded-lg border",children:e.jsx("div",{className:"text-2xl font-bold text-center text-gray-900 tracking-wider",children:a.game_code})}),e.jsx("button",{onClick:$,className:"p-3 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",title:"Kopyahin ang game code",children:G?e.jsx(O,{className:"w-5 h-5 text-green-600"}):e.jsx(X,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Max Players"}),e.jsx("div",{className:"flex items-center space-x-2",children:E?e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"number",min:"1",max:"100",value:p,onChange:s=>b(parseInt(s.target.value)),className:"flex-1 p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:l}),e.jsx("button",{onClick:A,disabled:l,className:"p-3 text-green-600 hover:text-green-700 hover:bg-green-50 rounded-lg transition-colors",children:l?e.jsx(g,{className:"w-5 h-5 animate-spin"}):e.jsx(q,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>{x(!1),b(a.max_players)},className:"p-3 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-lg transition-colors",children:e.jsx(Q,{className:"w-5 h-5"})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex-1 p-3 bg-gray-50 rounded-lg border",children:e.jsx("div",{className:"text-lg font-semibold text-center text-gray-900",children:a.max_players})}),a.status==="waiting"&&e.jsx("button",{onClick:()=>x(!0),className:"p-3 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition-colors",title:"I-edit ang max players",children:e.jsx(V,{className:"w-5 h-5"})})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Kasalukuyang Mga Manlalaro"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded-lg border",children:e.jsxs("div",{className:"text-lg font-semibold text-center text-gray-900",children:[a.players.length,"/",a.max_players]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Nilikha"}),e.jsxs("div",{className:"flex items-center p-3 bg-gray-50 rounded-lg border",children:[e.jsx(Y,{className:"w-4 h-4 mr-2 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-900",children:j(a.created_at)})]})]}),e.jsxs("div",{className:"sm:col-span-2 space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Word Bank"}),e.jsx("div",{className:"p-4 bg-blue-50 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-blue-900",children:a.word_bank?.name}),e.jsx("p",{className:"text-sm text-blue-700 mt-1",children:a.word_bank?.description||"No description available"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"flex items-center text-blue-600",children:[e.jsx(Z,{className:"w-4 h-4 mr-1"}),e.jsx("span",{className:"font-semibold",children:a.word_bank?.word_count})]}),e.jsx("span",{className:"text-xs text-blue-500",children:"words"})]})]})})]})]})]})})}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(ee,{className:"w-5 h-5 mr-2"}),"Players"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[a.players.length,"/",a.max_players]})]}),e.jsx("div",{className:"space-y-3 overflow-y-auto h-96",children:a.players&&a.players.length>0?a.players.map((s,t)=>e.jsxs(H,{href:route("games.players.show",[a.game_code,s.id]),as:"div",className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-white font-medium text-sm",children:s.name?s.name.charAt(0).toUpperCase():t+1}),e.jsxs("div",{className:"ml-3",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name||`Player ${t+1}`}),s.joined_at&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Joined:"," ",j(s.joined_at)]})]})]}),e.jsx("span",{className:`px-2 py-1 inline-flex items-center font-medium rounded-lg border text-xs ${T(s.status_info.label.toLowerCase())}`,children:s.status_info.label})]},s.id||t)):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(se,{className:"mx-auto h-8 w-8 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No players yet"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Share the game code to invite players"})]})}),a.status==="waiting"&&a.players.length<a.max_players&&e.jsx("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx(C,{className:"w-4 h-4 text-yellow-600 mt-0.5"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("p",{className:"text-xs text-yellow-800 font-medium",children:"Waiting for players"}),e.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"Game will auto-refresh when new players join"})]})]})}),a.status==="waiting"&&a.players.length===0&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex",children:[e.jsx(L,{className:"w-4 h-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"ml-2",children:[e.jsx("p",{className:"text-xs text-blue-800 font-medium",children:"Ready to play!"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"Need at least 1 player to start the game"})]})]})})]})}),N.length>0&&e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 rounded-lg shadow-sm border-2 border-yellow-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(ae,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Mga Nanalo"]}),e.jsx(te,{className:"w-6 h-6 text-yellow-600"})]}),e.jsx("div",{className:"space-y-3 overflow-y-auto h-96",children:N.map((s,t)=>e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg ${t===0?"bg-yellow-100 border-2 border-yellow-300":t===1?"bg-gray-100 border-2 border-gray-300":t===2?"bg-orange-100 border-2 border-orange-300":"bg-white border border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:U(t)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("div",{className:"text-xs text-gray-600",children:s.won_at&&j(s.won_at)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:["Rank #",t+1]}),s.play_time&&e.jsx("div",{className:"text-xs text-gray-500",children:s.play_time})]})]},s.id))})]})})]})]})]})}),e.jsx(re,{show:S,onClose:()=>h(!1),onConfirm:D,loading:l,isPaused:a.status==="paused"}),e.jsx(le,{show:P,onClose:()=>y(!1),onConfirm:I,loading:l})]})}export{ge as default};
