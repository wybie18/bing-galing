import{r as n,j as e,H as $,a as u,L as A}from"./app-E33wXCP4.js";import{z as l,A as R}from"./AuthenticatedLayout-DgZ6locj.js";import{n as T,C as F,v as H,D as U,k as z,B as _,b as K,c as I,z as O,L as q,A as J}from"./index-CBXdtjI5.js";import{M as Q}from"./index-4Cr1BXSf.js";import V from"./PauseGameModal-DMs65O0d.js";import X from"./EndGameModal-BH2j12bP.js";import"./transition-BCReLfx2.js";function le({game:c,current_word:S,statistics:y,recent_words:L}){const[t,m]=n.useState(c.data),[o,i]=n.useState(!1),[W,p]=n.useState(!1),[C,j]=n.useState(!1),[x,M]=n.useState(S||null),[g,P]=n.useState(L||[]),[f,N]=n.useState([]),[h,w]=n.useState({totalWords:y.total_words||0,wordsRemaining:y.words_remaining||0,playersWithBingo:y.calledWordsCount||0});n.useEffect(()=>{m(c.data);const s=c.data.players.filter(a=>a.status==="won").sort((a,r)=>new Date(a.won_at)-new Date(r.won_at));N(s)},[c.data]),n.useEffect(()=>(Echo.channel(`game.${t.game_code}`).listen(".player.joined",s=>{console.log("Player joined:",s),m(a=>({...a,players:[...a.players,s.player]})),l.success(s.message)}).listen(".player.left",s=>{console.log("Player left:",s),m(a=>({...a,players:a.players.filter(r=>r.id!==s.player.id)})),l.error(s.message)}).listen(".player.status.changed",s=>{console.log("Player status changed:",s),m(a=>({...a,players:a.players.map(r=>r.id===s.player.id?s.player:r)})),s.is_winner?(N(a=>a.some(d=>d.id===s.player.id)?a:(l.success(s.message),[...a,s.player])),w(a=>({...a,playersWithBingo:a.playersWithBingo+1}))):l(s.message)}).error(s=>{console.error("Echo error:",s)}),()=>{Echo.leaveChannel(`game.${t.game_code}`)}),[t.game_code]);const k=async()=>{i(!0);try{const s=await axios.post(route("games.call-word",t.game_code));if(s.data.current_word){const a=s.data.current_word;M(a),P(r=>[...r,a]),w({totalWords:s.data.statistics.total_words,wordsRemaining:s.data.statistics.words_remaining,playersWithBingo:h.playersWithBingo})}s.data.game_completed&&(l.success("Game completed! All words have been called."),u.reload())}catch(s){s.response?.data?.message?(alert(s.response.data.message),l.error(s.response.data.message)):l.error("Failed to call next word. Please try again.")}finally{i(!1)}},E=async()=>{i(!0);const s=t.can_pause,a=t.can_resume,r=a?"resume":"pause";try{const d=s?"games.pause":"games.resume";await axios.post(route(d,t.game_code));const b=a?"Game resumed successfully!":"Game paused successfully!";l.success(b),p(!1),u.reload({only:["game"]})}catch(d){if(console.error(`Error ${r}ing game:`,d),d.response?.data?.message)l.error(d.response.data.message);else{const b=a?"Failed to resume game. Please try again.":"Failed to pause game. Please try again.";l.error(b)}}finally{i(!1)}},G=()=>{i(!0),u.post(route("games.end",t.game_code),{},{onSuccess:()=>{j(!1),i(!1),l.success("Game ended!")},onError:()=>{i(!1)}})},v=s=>new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),B=s=>({joined:"bg-blue-100 text-blue-800",playing:"bg-green-100 text-green-800",won:"bg-yellow-100 text-yellow-800",disconnected:"bg-red-100 text-red-800"})[s]||"bg-gray-100 text-gray-800",D=s=>["🥇","🥈","🥉"][s]||"🏆";return e.jsxs(R,{header:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-green-400 to-blue-500 rounded-lg flex items-center justify-center",children:e.jsx(q,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold leading-tight text-gray-800",children:["Laro: ",t.game_code]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t.word_bank?.name," • ",t.status]})]})]}),t.status!="finished"&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>p(!0),disabled:o,className:`inline-flex items-center px-4 py-2 ${t.can_resume?"bg-green-600 hover:bg-green-700":"bg-orange-600 hover:bg-orange-700"} disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm`,children:t.can_resume?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Resume"]}):e.jsxs(e.Fragment,{children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Pause"]})}),e.jsxs("button",{onClick:()=>j(!0),disabled:o,className:"inline-flex items-center px-4 py-2 bg-red-600 hover:bg-red-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"Tapusin ang Laro"]})]})]}),children:[e.jsx($,{title:`Game ${t.game_code} - Active`}),e.jsx("div",{className:"py-6 sm:py-8",children:e.jsxs("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>u.visit(route("games.index")),className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx(T,{className:"w-4 h-4 mr-1"}),"Back to Games"]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-6",children:"Kasalukuyang Salita"}),x?e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-32 h-32 mx-auto bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center mb-4",children:e.jsx("span",{className:"text-3xl font-bold text-white",children:x.word||"Tawagin ang unang salita"})}),e.jsx("p",{className:"text-gray-600 text-lg mb-6",children:x.meaning||""})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(F,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Handa nang tawagin ang unang salita"})]}),t.status!="finished"&&e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:k,disabled:o,className:"inline-flex items-center px-8 py-4 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-medium rounded-lg transition-colors duration-200 shadow-sm text-lg",children:[o?e.jsx(H,{className:"w-5 h-5 mr-3 animate-spin ml-2"}):e.jsx(U,{className:"w-5 h-5 mr-3 ml-2"}),e.jsx("span",{className:"mr-2",children:x?"Tawagin ang Susunod na Salita":"Tawagin ang Unang Salita"})]})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Estadistika ng Laro"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:g.length}),e.jsx("div",{className:"text-sm text-blue-800",children:"Mga Salitang Tinawag"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:h.wordsRemaining}),e.jsx("div",{className:"text-sm text-green-800",children:"Mga Natitirang Salita"})]}),e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:h.playersWithBingo}),e.jsx("div",{className:"text-sm text-purple-800",children:"Mga Manlalarong may Bingo"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Mga Tinawag na Salita"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[g.length," of"," ",h.totalWords]})]}),g.length>0?e.jsx("div",{className:"max-h-64 overflow-y-auto",children:e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-2",children:g.slice().reverse().map((s,a)=>e.jsx("div",{className:`p-3 text-center rounded-lg border ${a===0?"bg-blue-100 border-blue-300 text-blue-800":"bg-gray-50 border-gray-200 text-gray-700"}`,children:e.jsx("div",{className:"font-medium",children:s.word})},s.id))})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(z,{className:"w-8 h-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Wala pang tinawag na salita"})]})]})})]}),e.jsxs("div",{className:"lg:col-span-1 space-y-6",children:[e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Impormasyon ng Laro"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Katayuan"}),e.jsxs("div",{className:"inline-flex items-center px-3 py-1 rounded-lg text-xs font-medium bg-green-100 text-green-800",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),"Aktibo"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Nagsimula"}),e.jsx("span",{className:"text-sm text-gray-900",children:v(t.started_at||t.created_at)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Word Bank"}),e.jsx("span",{className:"text-sm text-gray-900",children:t.word_bank?.name})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(K,{className:"w-5 h-5 mr-2"}),"Mga Manlalaro"]}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.players.length,"/",t.max_players]})]}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:t.players&&t.players.length>0?t.players.map((s,a)=>e.jsxs(A,{href:route("games.players.show",[t.game_code,s.id]),as:"div",className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-white font-medium text-sm",children:s.name?s.name.charAt(0).toUpperCase():a+1}),e.jsx("div",{className:"ml-3",children:e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name||`Player ${a+1}`})})]}),e.jsx("span",{className:`px-2 py-1 inline-flex items-center font-medium rounded-lg border text-xs ${B(s.status_info.label.toLowerCase())}`,children:s.status_info.label})]},s.id||a)):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-600",children:"Walang mga manlalaro"})})})]})}),f.length>0&&e.jsx("div",{className:"bg-gradient-to-br from-yellow-50 to-orange-50 rounded-lg shadow-sm border-2 border-yellow-200",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center",children:[e.jsx(I,{className:"w-5 h-5 mr-2 text-yellow-600"}),"Mga Nanalo"]}),e.jsx(O,{className:"w-6 h-6 text-yellow-600"})]}),e.jsx("div",{className:"space-y-3 overflow-y-auto h-96",children:f.map((s,a)=>e.jsxs("div",{className:`flex items-center justify-between p-4 rounded-lg ${a===0?"bg-yellow-100 border-2 border-yellow-300":a===1?"bg-gray-100 border-2 border-gray-300":a===2?"bg-orange-100 border-2 border-orange-300":"bg-white border border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-2xl",children:D(a)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("div",{className:"text-xs text-gray-600",children:s.won_at&&v(s.won_at)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm font-medium text-gray-700",children:["Rank #",a+1]}),s.play_time&&e.jsx("div",{className:"text-xs text-gray-500",children:s.play_time})]})]},s.id))})]})})]})]})]})}),e.jsx(V,{show:W,onClose:()=>p(!1),onConfirm:E,loading:o,isPaused:t.status==="paused"}),e.jsx(X,{show:C,onClose:()=>j(!1),onConfirm:G,loading:o})]})}export{le as default};
